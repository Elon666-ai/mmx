# 实现功能说明
## 自动/手动模式切换：
下拉菜单选择 Auto (ABR) 启动自动逻辑。
选择具体分辨率则强制锁定该流，不再因网络波动切换。
## ABR 算法 (Client-Side Logic)：
降级策略：激进降级。如果检测到 丢包率 > 5% 或 RTT > 500ms，立即切断当前流，连接低一档的流。
升级策略：保守升级。要求 0% 丢包 且 RTT < 200ms 且状态维持 10秒以上，才尝试切回高一档流。
冷却机制：每次切换后有 5秒冷却时间，防止在两个画质间反复横跳。
## 统计信息监控：
实时显示当前的码率 (Bitrate)、往返时延 (RTT)、丢包率 (Loss) 和帧率 (FPS)。
数据源自 WebRTC 标准 getStats() API。
## 低延迟优化：
每次切流成功后，会自动检测 Buffer，如果 Buffer 堆积超过 0.5秒，会自动跳帧追赶最新画面。

# 部署与测试
确保 mediamtx 服务器正在运行并在 localhost:8899 分发 4 个流。
将 index.html, reader.js, mmxplayer.js 放在同一个 Web 目录下。
使用 Chrome 或 Edge 浏览器访问 index.html。
测试 ABR：可以使用 Chrome 开发者工具 -> Network -> Throttling 模拟弱网（例如选择 "Fast 3G" 或自定义丢包），观察 "Quality" 下拉框是否会自动跳变，以及 Stats 面板中的 Loss/RTT 变化。

# 优化点详细说明
- 引入 EMA (指数移动平均)：
代码中增加了 this.emaMetrics。旧版代码直接使用瞬时 RTT 判断，导致偶尔一个 1000ms 的毛刺就会触发降级。
新版使用 EMA_ALPHA = 0.2，意味着新的测量值只占 20% 权重，历史值占 80%。这能有效过滤掉偶发的网络波动。
- 惩罚箱机制 (The Penalty Box)：
核心逻辑：当你从 1080P 降级到 720P 时，代码会记录 this.penaltyBox[0] = Date.now() + 60000。
效果：在接下来的 60秒 内，即使网络变得极好（RTT < 50ms），算法也会直接忽略升级到 1080P 的请求。
解决震荡：这彻底解决了“带宽天花板”导致的震荡。如果你的带宽只能跑 1.5M，上不去 1080P，系统尝试一次失败后，就会老实地在 720P 待上一分钟，不再反复折腾。
- 苛刻的升级条件：
升级阈值设为 RTT < 150ms 且 Loss == 0%。
要求 stableCount >= 10（连续 10秒满足条件）。
这体现了 “快速降级（保命），缓慢升级（体验）” 的设计原则。
- UI 增强：
统计面板现在会显示 RTT (EMA) 平滑值，让你看到算法依据的数据。
如果有清晰度被“关禁闭”，面板下方会显示红色倒计时（例如：🚫 1080p banned: 58s），方便调试。


